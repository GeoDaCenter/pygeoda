

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6 Spatial Clustering &mdash; pygeoda 0.0.8 rc documentation</title>
  

  
  
  
  
    <link rel="canonical" href="https://geodacenter.github.io/pygeodaspatial_clustering.html"/>
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="_ESDA with pygeoda and geopandas" href="esda_geopandas.html" />
    <link rel="prev" title="5 Local Indicators of Spatial Association–LISA" href="spatial_auto.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >
          

          
            <a href="index.html" class="icon icon-home"> pygeoda
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">USER GUIDE</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#open-resources">1.1 Open Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="install.html">2. Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#windows">2.1 Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#linux">2.2 Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#mac">2.3 Mac</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#import-pygeoda">2.4 Import pygeoda</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="load_data.html">3. Load Spatial Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="load_data.html#attributes-of-geoda-object">3.1 Attributes of geoda object</a></li>
<li class="toctree-l2"><a class="reference internal" href="load_data.html#access-table-data">3.2 Access Table Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="map_classification.html">4. Map Classification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="map_classification.html#hinge-box-breaks">4.1 Hinge Box Breaks</a></li>
<li class="toctree-l2"><a class="reference internal" href="map_classification.html#natural-breaks">4.2 Natural Breaks</a></li>
<li class="toctree-l2"><a class="reference internal" href="map_classification.html#quantile-breaks">4.3 Quantile Breaks</a></li>
<li class="toctree-l2"><a class="reference internal" href="map_classification.html#percentile-breaks">4.4 Percentile Breaks</a></li>
<li class="toctree-l2"><a class="reference internal" href="map_classification.html#standard-deviation-breaks">4.5 Standard Deviation Breaks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spatial_weights.html">5. Spatial Weights</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spatial_weights.html#queen-contiguity-weights">5.1 Queen Contiguity Weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_weights.html#attributes-of-weight-object">5.2 Attributes of <cite>Weight</cite> object</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_weights.html#rook-contiguity-weights">5.3 Rook Contiguity Weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_weights.html#distance-based-weights">5.4 Distance Based Weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_weights.html#k-nearest-neighbor-weights">5.5 K-Nearest Neighbor Weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_weights.html#kernel-weights">5.6 Kernel Weights</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spatial_weights.html#kernel-weights-with-fixed-bandwidth">5.6.1 Kernel Weights with fixed bandwidth</a></li>
<li class="toctree-l3"><a class="reference internal" href="spatial_weights.html#kernel-weights-with-adaptive-bandwidth">5.6.2 Kernel Weights with adaptive bandwidth</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spatial_auto.html">6. Local Indicators of Spatial Association</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spatial_auto.html#local-moran">6.1 Local Moran</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_auto.html#lisa-object">6.2 LISA object</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_auto.html#local-geary">6.3 Local Geary</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_auto.html#local-getis-ord-statistics">6.4 Local Getis-Ord Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_auto.html#local-join-count">6.5 Local Join Count</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_auto.html#local-bivariate-join-count">6.6 Local Bivariate Join Count</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_auto.html#local-multivariate-join-count">6.7 Local Multivariate Join Count</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_auto.html#quantile-lisa">6.8 Quantile LISA</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_auto.html#multivariate-quantile-lisa">6.9 Multivariate Quantile LISA</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_auto.html#neighbor-match-test">6.10 Neighbor Match Test</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">7. Spatial Clustering</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#skater">7.1 SKATER</a></li>
<li class="toctree-l2"><a class="reference internal" href="#redcap">7.2 REDCAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="#spatially-constrained-hierarchical-clucstering">7.3 Spatially Constrained Hierarchical Clucstering</a></li>
<li class="toctree-l2"><a class="reference internal" href="#azp">7.3 AZP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#azp-greedy">7.3.1 AZP greedy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#azp-simulated-annealing">7.3.2 AZP Simulated Annealing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#azp-tabu-search">7.3.3 AZP Tabu Search</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#max-p">7.4 Max-p</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#max-p-greedy">7.4.1 Max-p greedy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#max-p-tabu-search">7.4.2 Max-p Tabu Search</a></li>
<li class="toctree-l3"><a class="reference internal" href="#max-p-simulated-annealing">7.4.3 Max-p Simulated Annealing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="esda_geopandas.html">ESDA with pygeoda and geopandas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="esda_geopandas.html#geopandas">1 GeoPandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="esda_geopandas.html#matplotlib">2 Matplotlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="esda_geopandas.html#geopandas-pygeoda">3 GeoPandas + pygeoda</a><ul>
<li class="toctree-l3"><a class="reference internal" href="esda_geopandas.html#load-geospatial-data-in-geopandas">3.1 Load geospatial data in GeoPandas</a></li>
<li class="toctree-l3"><a class="reference internal" href="esda_geopandas.html#create-pygeoda-object-from-geodataframe">3.2 Create pygeoda object from geodataframe</a></li>
<li class="toctree-l3"><a class="reference internal" href="esda_geopandas.html#id1">3.3 ESDA with pygeoda and geopandas</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API REFERENCE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">pygeoda API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.html#pygeoda-i-o">pygeoda (I/O)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.open.html">pygeoda.open</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.geoda.html">pygeoda.geoda</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api.html#pygeoda-weights">pygeoda.weights</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.Weight.html">pygeoda.Weight</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.queen_weights.html">pygeoda.queen_weights</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.rook_weights.html">pygeoda.rook_weights</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.min_distthreshold.html">pygeoda.min_distthreshold</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.distance_weights.html">pygeoda.distance_weights</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.knn_weights.html">pygeoda.knn_weights</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.kernel_weights.html">pygeoda.kernel_weights</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.kernel_knn_weights.html">pygeoda.kernel_knn_weights</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api.html#pygeoda-lisa">pygeoda (LISA)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.lisa.html">pygeoda.lisa</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.local_moran.html">pygeoda.local_moran</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.local_geary.html">pygeoda.local_geary</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.local_multigeary.html">pygeoda.local_multigeary</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.local_joincount.html">pygeoda.local_joincount</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.local_bijoincount.html">pygeoda.local_bijoincount</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.local_multijoincount.html">pygeoda.local_multijoincount</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.local_g.html">pygeoda.local_g</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.local_gstar.html">pygeoda.local_gstar</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.local_quantilelisa.html">pygeoda.local_quantilelisa</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.local_multiquantilelisa.html">pygeoda.local_multiquantilelisa</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.neighbor_match_test.html">pygeoda.neighbor_match_test</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.batchlisa.html">pygeoda.batchlisa</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.batch_local_moran.html">pygeoda.batch_local_moran</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api.html#pygeoda-spatial-clustering">pygeoda (spatial clustering)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.skater.html">pygeoda.skater</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.redcap.html">pygeoda.redcap</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.schc.html">pygeoda.schc</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.azp_greedy.html">pygeoda.azp_greedy</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.azp_sa.html">pygeoda.azp_sa</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.azp_tabu.html">pygeoda.azp_tabu</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.maxp_greedy.html">pygeoda.maxp_greedy</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.maxp_sa.html">pygeoda.maxp_sa</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.maxp_tabu.html">pygeoda.maxp_tabu</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api.html#pygeoda-classify">pygeoda (classify)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.hinge15_breaks.html">pygeoda.hinge15_breaks</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.hinge30_breaks.html">pygeoda.hinge30_breaks</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.natural_breaks.html">pygeoda.natural_breaks</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.quantile_breaks.html">pygeoda.quantile_breaks</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.percentile_breaks.html">pygeoda.percentile_breaks</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.stddev_breaks.html">pygeoda.stddev_breaks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api.html#pygeoda-data">pygeoda (data)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.demean.html">pygeoda.demean</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.standardize.html">pygeoda.standardize</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.mad.html">pygeoda.mad</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pygeoda</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>6 Spatial Clustering</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/spatial_clustering.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="spatial-clustering">
<span id="spatial-clustering-ref"></span><h1>6 Spatial Clustering<a class="headerlink" href="#spatial-clustering" title="Permalink to this headline">¶</a></h1>
<p>Spatial clustering aims to group of a large number of
geographic areas or points into a smaller number of regions
based on similiarities in one or more variables.
Spatially constrained clustering is needed when clusters are
required to be spatially contiguous.</p>
<p>In pygeoda, there are three different approaches
explicitly incorporate the contiguity constraint in the
optimization process: SKATER, Redcap and Max-p.
For more details, please read:
* <a class="reference external" href="http://geodacenter.github.io/workbook/9c_spatial3/lab9c.html">http://geodacenter.github.io/workbook/9c_spatial3/lab9c.html</a>
* <a class="reference external" href="http://geodacenter.github.io/workbook/9d_spatial4/lab9d.html">http://geodacenter.github.io/workbook/9d_spatial4/lab9d.html</a></p>
<p>For example, to apply spatial clustering on the Guerry dataset,
we use the queen weights to define the spatial contiguity
and select 6 variables for similarity measure:
“Crm_prs”, “Crm_prp”, “Litercy”, “Donatns”, “Infants”, “Suicids”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">guerry</span><span class="p">[[</span><span class="s2">&quot;Crm_prs&quot;</span><span class="p">,</span> <span class="s2">&quot;Crm_prp&quot;</span><span class="p">,</span> <span class="s2">&quot;Litercy&quot;</span><span class="p">,</span> <span class="s2">&quot;Donatns&quot;</span><span class="p">,</span> <span class="s2">&quot;Infants&quot;</span><span class="p">,</span> <span class="s2">&quot;Suicids&quot;</span><span class="p">]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span>
</pre></div>
</div>
<div class="section" id="skater">
<h2>7.1 SKATER<a class="headerlink" href="#skater" title="Permalink to this headline">¶</a></h2>
<p>The Spatial C(K)luster Analysis by Tree Edge Removal(SKATER)
algorithm introduced by Assuncao et al. (2006) is based on
the optimal pruning of a minimum spanning tree that reflects
the contiguity structure among the observations. It provides
an optimized algorithm to prune to tree into several clusters
that their values of selected variables are as similar as possible.</p>
<p>The SKATER function in pygeoda:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pygeoda</span><span class="o">.</span><span class="n">skater</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">distance_method</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="n">bound_vals</span> <span class="o">=</span> <span class="p">[],</span>  <span class="n">min_bound</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">123456789</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The parameters <cite>distance_method</cite>, <cite>bound_vals</cite>, <cite>min_bound</cite> and <cite>random_seed</cite> are optional.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See [Max-p] for the usage of  <cite>bound_vals</cite> and <cite>min_bound</cite>.</p>
</div>
<p>For example, to create 4 spatially contiguous clusters using
<cite>skater()</cite> with Guerry dataset, the queen weights and the
values of the 6 selected variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">skater_clusters</span> <span class="o">=</span> <span class="n">pygeoda</span><span class="o">.</span><span class="n">skater</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">queen_w</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">skater_clusters</span>
<span class="go">{&#39;Total sum of squares&#39;: 504.0000000000001,</span>
<span class="go">&#39;Within-cluster sum of squares&#39;: [57.890768263715266,</span>
<span class="go">59.95241669262987,</span>
<span class="go">28.725706194374844,</span>
<span class="go">69.3802999471999,</span>
<span class="go">62.30781060793979,</span>
<span class="go">66.65808666485573],</span>
<span class="go">&#39;Total within-cluster sum of squares&#39;: 159.0849116292847,</span>
<span class="go">&#39;The ratio of between to total sum of squares&#39;: 0.3156446659311204,</span>
<span class="go">&#39;Clusters&#39;: (3, 2, 3, 1, 1, 1, 2, 1,...)</span>
<span class="go">}</span>
</pre></div>
</div>
<p>This skater() function returns a names list with names “Clusters”,
“Total sum of squares”, “Within-cluster sum of squares”,
“Total within-cluster sum of squares”, and “The ratio of between
to total sum of squares”.</p>
</div>
<div class="section" id="redcap">
<h2>7.2 REDCAP<a class="headerlink" href="#redcap" title="Permalink to this headline">¶</a></h2>
<p>REDCAP (Regionalization with dynamically constrained agglomerative
clustering and partitioning) is developed by D. Guo (2008).
Like SKATER, REDCAP starts from building a spanning tree with
4 different ways (single-linkage, average-linkage, complete-linkage and wards-linkage).
Then,REDCAP provides 2 different ways (first‐order and full-order
constraining) to prune the tree to find clusters. The first-order
approach with a minimum spanning tree is exactly the same with SKATER.
In GeoDa and pygeoda, the following methods are provided:</p>
<ul class="simple">
<li><p>First-order and Single-linkage</p></li>
<li><p>Full-order and Complete-linkage</p></li>
<li><p>Full-order and Average-linkage</p></li>
<li><p>Full-order and Single-linkage</p></li>
<li><p>Full-order and Wards-linkage</p></li>
</ul>
<p>For example, to find 4 clusters using the same dataset and weights
as above using REDCAP with Full-order and Complete-linkage method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">redcap_clusters</span> <span class="o">=</span> <span class="n">pygeoda</span><span class="o">.</span><span class="n">redcap</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">queen_w</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;fullorder-completelinkage&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">redcap_clusters</span>
<span class="go">{&#39;Total sum of squares&#39;: 504.0000000000001,</span>
<span class="go">&#39;Within-cluster sum of squares&#39;: [59.33033487635985,</span>
<span class="go">55.0157958268228,</span>
<span class="go">28.202717566163827,</span>
<span class="go">68.5897406247226,</span>
<span class="go">61.2723190783986,</span>
<span class="go">54.63519052499109],</span>
<span class="go">&#39;Total within-cluster sum of squares&#39;: 176.95390150254138,</span>
<span class="go">&#39;The ratio of between to total sum of squares&#39;: 0.35109901091774076,</span>
<span class="go">&#39;Clusters&#39;: (1, 2, 1, 3, 3, 1, 2,...)</span>
<span class="go">}</span>
</pre></div>
</div>
</div>
<div class="section" id="spatially-constrained-hierarchical-clucstering">
<h2>7.3 Spatially Constrained Hierarchical Clucstering<a class="headerlink" href="#spatially-constrained-hierarchical-clucstering" title="Permalink to this headline">¶</a></h2>
<p>Spatially constrained hierarchical clustering is a special form of constrained clustering,
where the constraint is based on contiguity (common borders). The method builds up the
clusters using agglomerative hierarchical clustering methods: single linkage,
complete linkage, average linkage and Ward’s method (a special form of centroid linkage).
Meanwhile, it also maintains the spatial contiguity when merging two clusters.</p>
<p>For example, to find 4 spatially constrained clusters using the same dataset and weights
as above using Complete-linkage method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">schc_clusters</span> <span class="o">=</span> <span class="n">pygeoda</span><span class="o">.</span><span class="n">schc</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">queen_w</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s2">&quot;complete&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">schc</span>
<span class="go">{&#39;Total sum of squares&#39;: 504.0000000000001,</span>
<span class="go">&#39;Within-cluster sum of squares&#39;: [78.13831458170165,</span>
<span class="go">54.758683422512384,</span>
<span class="go">81.49770916157574,</span>
<span class="go">63.48674702445253,</span>
<span class="go">80.60111094248678,</span>
<span class="go">65.74388628224132],</span>
<span class="go">&#39;Total within-cluster sum of squares&#39;: 79.77354858502969,</span>
<span class="go">&#39;The ratio of between to total sum of squares&#39;: 0.15828085036712236,</span>
<span class="go">&#39;Clusters&#39;: (1,1,1,1,1,1,...)</span>
<span class="go">}</span>
</pre></div>
</div>
</div>
<div class="section" id="azp">
<h2>7.3 AZP<a class="headerlink" href="#azp" title="Permalink to this headline">¶</a></h2>
<p>The automatic zoning procedure (AZP) was initially outlined in Openshaw (1977) as
a way to address some of the consequences of the modifiable areal unit problem
(MAUP). In essence, it consists of a heuristic to find the best set of
combinations of contiguous spatial units into p regions, minimizing the
within-sum of squares as a criterion of homogeneity. The number of regions
needs to be specified beforehand, as in most other clustering methods considered so far.</p>
<p>pygeoda provides three different heuristic algorithms to find an optimal solution for AZP:</p>
<ul class="simple">
<li><p>greedy</p></li>
<li><p>Tabu Search</p></li>
<li><p>Simulated Annealing</p></li>
</ul>
<div class="section" id="azp-greedy">
<h3>7.3.1 AZP greedy<a class="headerlink" href="#azp-greedy" title="Permalink to this headline">¶</a></h3>
<p>The original AZP heuristic is a local optimization procedure that cycles
through a series of possible swaps between spatial units at the boundary of a set
of regions. The process starts with an initial feasible solution, i.e.,
a grouping of n spatial units into p contiguous regions. This initial
solution can be constructed in several different ways. The initial
solution must satisfy the contiguity constraints. For example, this
can be accomplished by growing a set of contiguous regions from p
randomly selected seed units by adding neighboring locations until
the contiguity constraint can no longer be met.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">azp_clusters</span> <span class="o">=</span> <span class="n">pygeoda</span><span class="o">.</span><span class="n">azp_greedy</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">queen_w</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">azp_clusters</span>
<span class="go">{&#39;Total sum of squares&#39;: 504.0000000000001,</span>
<span class="go">&#39;Within-cluster sum of squares&#39;: [47.20702629865675,</span>
<span class="go">60.10164576171729,</span>
<span class="go">32.71213364540346,</span>
<span class="go">57.69759599152196,</span>
<span class="go">59.4167280770582,</span>
<span class="go">65.49840467351049],</span>
<span class="go">&#39;Total within-cluster sum of squares&#39;: 181.3664655521319,</span>
<span class="go">&#39;The ratio of between to total sum of squares&#39;: 0.3598540983177219,</span>
<span class="go">&#39;Clusters&#39;: (5, 2, 3, 1, 1, 1, ...)</span>
<span class="go">}</span>
</pre></div>
</div>
</div>
<div class="section" id="azp-simulated-annealing">
<h3>7.3.2 AZP Simulated Annealing<a class="headerlink" href="#azp-simulated-annealing" title="Permalink to this headline">¶</a></h3>
<p>To call AZP simulate annealing algorithm, one needs to specify cooling_rate (default: 0.85):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">azp_clusters</span> <span class="o">=</span> <span class="n">pygeoda</span><span class="o">.</span><span class="n">azp_sa</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">queen_w</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">cooling_rate</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">azp_clusters</span>
<span class="go">{&#39;Total sum of squares&#39;: 504.0000000000001,</span>
<span class="go">&#39;Within-cluster sum of squares&#39;: [55.44537005496083,</span>
<span class="go">44.49165717470521,</span>
<span class="go">31.26639087099905,</span>
<span class="go">44.79845917679877,</span>
<span class="go">61.49413146833172,</span>
<span class="go">54.251299642381724],</span>
<span class="go">&#39;Total within-cluster sum of squares&#39;: 212.25269161182268,</span>
<span class="go">&#39;The ratio of between to total sum of squares&#39;: 0.42113629288060045,</span>
<span class="go">&#39;Clusters&#39;: (5, 2, 5, 1, 1, 1, 2, 1, ...}</span>
<span class="go">}</span>
</pre></div>
</div>
</div>
<div class="section" id="azp-tabu-search">
<h3>7.3.3 AZP Tabu Search<a class="headerlink" href="#azp-tabu-search" title="Permalink to this headline">¶</a></h3>
<p>To call AZP Tabu search algorithm, one needs to specify tabu_length (deafult: 10) ,
or conv_tabu (default: 10):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">azp_clusters</span> <span class="o">=</span> <span class="n">pygeoda</span><span class="o">.</span><span class="n">azp_tabu</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">queen_w</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">tabu_length</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">conv_tabu</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">azp_clusters</span>
<span class="go">{&#39;Total sum of squares&#39;: 504.0000000000001,</span>
<span class="go">&#39;Within-cluster sum of squares&#39;: [52.20795794704135,</span>
<span class="go">39.86439151302456,</span>
<span class="go">30.75532090551626,</span>
<span class="go">54.95105937296297,</span>
<span class="go">54.004395690763246,</span>
<span class="go">59.41930677822133],</span>
<span class="go">&#39;Total within-cluster sum of squares&#39;: 212.79756779247032,</span>
<span class="go">&#39;The ratio of between to total sum of squares&#39;: 0.4222173964136315,</span>
<span class="go">&#39;Clusters&#39;: (4, 1, 2, 3, 3, 3, ...)</span>
<span class="go">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>NOTE: the AZP algorithm is very sensitive to the initial positions for constructing final solutions.
Therefore, the random seed, which is used to determine the initial positions, could be used
to execute several rounds of max-p algorithms for sensitive analysis.</p>
</div>
</div>
</div>
<div class="section" id="max-p">
<h2>7.4 Max-p<a class="headerlink" href="#max-p" title="Permalink to this headline">¶</a></h2>
<p>The so-called max-p regions model (outlined in Duque, Anselin, and Rey 2012)
uses a different approach and considers the regionalization problem as
an application of integer programming. In addition, the number of regions
is determined endogenously.</p>
<p>The algorithm itself consists of a search process that starts with an
initial feasible solution and iteratively improves upon it while
maintaining contiguity among the elements of each cluster.
Like Geoda, pygeoda provides three different heuristic algorithms to
find an optimal solution for max-p:</p>
<ul class="simple">
<li><p>greedy</p></li>
<li><p>Tabu Search</p></li>
<li><p>Simulated Annealing</p></li>
</ul>
<p>Unlike SKATER and REDCAP that one can specify the number of clusters
as an input paramter, max-p doesn’t allow to specify the number of
clusters explicitly, but a constrained variable and the minimum bounding
value that each cluster should reach that are used to find an optimized
number of clusters.</p>
<div class="section" id="max-p-greedy">
<h3>7.4.1 Max-p greedy<a class="headerlink" href="#max-p-greedy" title="Permalink to this headline">¶</a></h3>
<p>For example, to use <cite>greedy</cite> algorithm in maxp function with the same
dataset and weights as above to find optimal clusters using max-p:</p>
<p>First, we need to specify, for example, every cluster must have
population &gt;= 3236.67 thousands people:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bound_vals</span> <span class="o">=</span> <span class="n">guerry</span><span class="p">[</span><span class="s2">&quot;Pop1831&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">min_bound</span> <span class="o">=</span> <span class="mf">3236.67</span> <span class="c1"># 10% of Pop1831</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">bound_vals</span><span class="p">)</span>
<span class="go">(346.03, 513.0, 298.26, 155.9, 129.1, 340.73, 289.62, 253.12, 246.36, 270.13, 359.06, 359.47, 494.7, 258.59, 362.53, 445.25, 256.06, 294.83, 375.88, 598.87, 265.38, 482.75, 265.54, 299.56, 424.25, 278.82, 524.4, 357.38, 427.86, 312.16, 554.23, 346.3, 547.05, 245.29, 297.02, 550.26, 312.5, 281.5, 235.75, 391.22, 292.08, 470.09, 305.28, 283.83, 346.89, 140.35, 467.87, 591.28, 337.08, 249.83, 352.59, 415.57, 314.59, 433.52, 417.0, 282.52, 989.94, 397.73, 441.88, 655.22, 573.11, 428.4, 233.03, 157.05, 540.21, 424.26, 434.43, 338.91, 523.97, 457.37, 935.11, 693.68, 323.89, 448.18, 297.85, 543.7, 333.84, 242.51, 317.5, 239.11, 330.36, 282.73, 285.13, 397.99, 352.49)</span>
</pre></div>
</div>
<p>Then, we can call the max-p function with “greedy” algorithm,
the bound values and minimum bound value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">maxp_clusters</span> <span class="o">=</span> <span class="n">pygeoda</span><span class="o">.</span><span class="n">maxp_greedy</span><span class="p">(</span><span class="n">queen_w</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">bound_vals</span><span class="p">,</span> <span class="n">min_bound</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">maxp_clusters</span>
<span class="go">{&#39;Total sum of squares&#39;: 504.0000000000001,</span>
<span class="go">&#39;Within-cluster sum of squares&#39;: [58.53340105931292,</span>
<span class="go">44.29869690985993,</span>
<span class="go">26.788351483048764,</span>
<span class="go">50.6761352058351,</span>
<span class="go">50.075425319038615,</span>
<span class="go">46.844568220802984],</span>
<span class="go">&#39;Total within-cluster sum of squares&#39;: 226.7834218021017,</span>
<span class="go">&#39;The ratio of between to total sum of squares&#39;: 0.4499671067502017,</span>
<span class="go">&#39;Clusters&#39;: (4,8,6,3,4,3,...)</span>
<span class="go">}</span>
</pre></div>
</div>
</div>
<div class="section" id="max-p-tabu-search">
<h3>7.4.2 Max-p Tabu Search<a class="headerlink" href="#max-p-tabu-search" title="Permalink to this headline">¶</a></h3>
<p>We can also specify using <cite>Tabu Search</cite> algorithm in maxp function
with the parameter of tabu length:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">maxp_tabu_clusters</span> <span class="o">=</span> <span class="n">pygeoda</span><span class="o">.</span><span class="n">maxp_tabu</span><span class="p">(</span><span class="n">queen_w</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">bound_vals</span><span class="p">,</span> <span class="n">min_bound</span><span class="p">,</span>  <span class="n">tabu_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">conv_tabu</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">maxp_tabu_clusters</span>
<span class="go">{&#39;Total sum of squares&#39;: 504.0000000000001,</span>
<span class="go">&#39;Within-cluster sum of squares&#39;: [41.67029875441199,</span>
<span class="go">38.07924627625834,</span>
<span class="go">26.226691715076896,</span>
<span class="go">52.738669711271385,</span>
<span class="go">44.51343645827698,</span>
<span class="go">54.13078236136856],</span>
<span class="go">&#39;Total within-cluster sum of squares&#39;: 246.6408747233359,</span>
<span class="go">&#39;The ratio of between to total sum of squares&#39;: 0.4893668149272537,</span>
<span class="go">&#39;Clusters&#39;: (6,2,6,1,1,6,2,1,3,...)</span>
</pre></div>
</div>
</div>
<div class="section" id="max-p-simulated-annealing">
<h3>7.4.3 Max-p Simulated Annealing<a class="headerlink" href="#max-p-simulated-annealing" title="Permalink to this headline">¶</a></h3>
<p>To apply <cite>simulated annealing</cite> algorithm in maxp function with
the parameter of cooling rate:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">maxp_sa_clusters</span> <span class="o">=</span> <span class="n">pygeoda</span><span class="o">.</span><span class="n">maxp_sa</span><span class="p">(</span><span class="n">queen_w</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">bound_vals</span><span class="p">,</span> <span class="n">min_bound</span><span class="p">,</span> <span class="n">cooling_rate</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">sa_maxit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">maxp_sa_clusters</span>
<span class="go">{&#39;Total sum of squares&#39;: 504.0000000000001,</span>
<span class="go">&#39;Within-cluster sum of squares&#39;: [49.54630063745117,</span>
<span class="go">52.715283326199796,</span>
<span class="go">31.389297593661983,</span>
<span class="go">47.57063859231485,</span>
<span class="go">44.96761523907647,</span>
<span class="go">46.709112570389934],</span>
<span class="go">&#39;Total within-cluster sum of squares&#39;: 231.10175204090598,</span>
<span class="go">&#39;The ratio of between to total sum of squares&#39;: 0.4585352223033848,</span>
<span class="go">&#39;Clusters&#39;: (2,8,5,2,2,4,8,...)</span>
<span class="go">}</span>
</pre></div>
</div>
<p>We can also increase the number of iterations for local search process by specifying the parameter <cite>initial</cite> (default value is 99):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">maxp_clusters</span> <span class="o">=</span> <span class="n">pygeoda</span><span class="o">.</span><span class="n">maxp_greedy</span><span class="p">(</span><span class="n">queen_w</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">bound_vals</span><span class="p">,</span> <span class="n">min_bound</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="mi">199</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">maxp_clusters</span>
<span class="go">{&#39;Total sum of squares&#39;: 504.0000000000001,</span>
<span class="go">&#39;Within-cluster sum of squares&#39;: (50.454710071353645,</span>
<span class="go">42.41705106362629,</span>
<span class="go">23.35406627133095,</span>
<span class="go">52.46200977080593,</span>
<span class="go">47.809353880636685,</span>
<span class="go">46.88761433133685),</span>
<span class="go">&#39;Total within-cluster sum of squares&#39;: 240.61519461090978,</span>
<span class="go">&#39;The ratio of between to total sum of squares&#39;: 0.4774111004184717,</span>
<span class="go">&#39;Clusters&#39;: (2,7,4,2,2,2,7,...)</span>
<span class="go">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>NOTE: the max-p algorithm is very sensitive to the initial positions for constructing final solutions.
Therefore, the random seed, which is used to determine the initial positions, could be used
to execute several rounds of max-p algorithms for sensitive analysis.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="esda_geopandas.html" class="btn btn-neutral float-right" title="_ESDA with pygeoda and geopandas" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="spatial_auto.html" class="btn btn-neutral float-left" title="5 Local Indicators of Spatial Association–LISA" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Xun Li; Luc Anselin.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-182260526-2', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>