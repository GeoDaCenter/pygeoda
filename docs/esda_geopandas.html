

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>_ESDA with pygeoda and geopandas &mdash; pygeoda 0.0.4 rc documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="static/documentation_options.js"></script>
        <script type="text/javascript" src="static/jquery.js"></script>
        <script type="text/javascript" src="static/underscore.js"></script>
        <script type="text/javascript" src="static/doctools.js"></script>
        <script type="text/javascript" src="static/language_data.js"></script>
    
    <script type="text/javascript" src="static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pygeoda API reference" href="api.html" />
    <link rel="prev" title="6 Spatial Clustering" href="spatial_clustering.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #343131" >
          

          
            <a href="index.html" class="icon icon-home"> pygeoda
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">USER GUIDE</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="intro.html#live-tutorials">1.1  Live Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="intro.html#open-resources">1.2 Open Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="install.html">2. Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#mac">2.1 Mac</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#windows">2.2 Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#linux">2.3 Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#import-pygeoda">2.4 Import pygeoda</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="load_data.html">3. Load Spatial Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="load_data.html#attributes-of-geoda-object">3.1 Attributes of geoda object</a></li>
<li class="toctree-l2"><a class="reference internal" href="load_data.html#access-table-data">3.1 Access Table Data</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="map_classification.html">4. Map Classification</a><ul>
<li class="toctree-l2"><a class="reference internal" href="map_classification.html#hinge-box-breaks">4.1 Hinge Box Breaks</a></li>
<li class="toctree-l2"><a class="reference internal" href="map_classification.html#natural-breaks">4.2 Natural Breaks</a></li>
<li class="toctree-l2"><a class="reference internal" href="map_classification.html#quantile-breaks">4.3 Quantile Breaks</a></li>
<li class="toctree-l2"><a class="reference internal" href="map_classification.html#percentile-breaks">4.4 Percentile Breaks</a></li>
<li class="toctree-l2"><a class="reference internal" href="map_classification.html#standard-deviation-breaks">4.5 Standard Deviation Breaks</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spatial_weights.html">5. Spatial Weights</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spatial_weights.html#queen-contiguity-weights">5.1 Queen Contiguity Weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_weights.html#attributes-of-weight-object">5.2 Attributes of <cite>Weight</cite> object</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_weights.html#rook-contiguity-weights">5.3 Rook Contiguity Weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_weights.html#distance-based-weights">5.4 Distance Based Weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_weights.html#k-nearest-neighbor-weights">5.5 K-Nearest Neighbor Weights</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_weights.html#kernel-weights">5.6 Kernel Weights</a><ul>
<li class="toctree-l3"><a class="reference internal" href="spatial_weights.html#kernel-weights-with-fixed-bandwidth">5.6.1 Kernel Weights with fixed bandwidth</a></li>
<li class="toctree-l3"><a class="reference internal" href="spatial_weights.html#kernel-weights-with-adaptive-bandwidth">5.6.2 Kernel Weights with adaptive bandwidth</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spatial_auto.html">6. Spatial Autocorrelation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spatial_auto.html#local-moran">6.1 Local Moran</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_auto.html#lisa-object">6.2 LISA object</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_auto.html#local-geary">6.3 Local Geary</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_auto.html#local-getis-ord-statistics">6.4 Local Getis-Ord Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_auto.html#local-join-count">6.5 Local Join Count</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_auto.html#quantile-lisa">6.6 Quantile LISA</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_auto.html#batch-local-moran">6.7 Batch Local Moran</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spatial_clustering.html">7. Spatial Clustering</a><ul>
<li class="toctree-l2"><a class="reference internal" href="spatial_clustering.html#skater">7.1 SKATER</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_clustering.html#redcap">7.2 REDCAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial_clustering.html#max-p">7.3 Max-p</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">ESDA with pygeoda and geopandas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#geopandas">1 GeoPandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="#matplotlib">2 Matplotlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="#geopandas-pygeoda">3 geoPandas + pygeoda</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#load-geospatial-data-in-geopandas">3.1 Load geospatial data in GeoPandas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-pygeoda-object-from-geodataframe">3.2 Create pygeoda object from geodataframe</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">3.3 ESDA with pygeoda and geopandas</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API REFERENCE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">pygeoda API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.html#pygeoda-i-o">pygeoda (I/O)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.open.html">pygeoda.open</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.geopandas_to_geoda.html">pygeoda.geopandas_to_geoda</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.geoda_to_geopandas.html">pygeoda.geoda_to_geopandas</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.geoda.html">pygeoda.geoda</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api.html#pygeoda-weights">pygeoda.weights</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.weights.Weight.html">pygeoda.weights.Weight</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.weights.queen.html">pygeoda.weights.queen</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.weights.rook.html">pygeoda.weights.rook</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.weights.distance.html">pygeoda.weights.distance</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.weights.knn.html">pygeoda.weights.knn</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.weights.kernel.html">pygeoda.weights.kernel</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api.html#pygeoda-spatial-autocorrelation">pygeoda (spatial autocorrelation)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.lisa.html">pygeoda.lisa</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.batchlisa.html">pygeoda.batchlisa</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.local_moran.html">pygeoda.local_moran</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.batch_local_moran.html">pygeoda.batch_local_moran</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.local_geary.html">pygeoda.local_geary</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.local_multigeary.html">pygeoda.local_multigeary</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.local_joincount.html">pygeoda.local_joincount</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.local_multijoincount.html">pygeoda.local_multijoincount</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.local_g.html">pygeoda.local_g</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.local_gstar.html">pygeoda.local_gstar</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.quantile_lisa.html">pygeoda.quantile_lisa</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api.html#pygeoda-spatial-clustering">pygeoda (spatial clustering)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.skater.html">pygeoda.skater</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.redcap.html">pygeoda.redcap</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.maxp.html">pygeoda.maxp</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.between_sumofsquare.html">pygeoda.between_sumofsquare</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.total_sumofsquare.html">pygeoda.total_sumofsquare</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.within_sumofsquare.html">pygeoda.within_sumofsquare</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api.html#pygeoda-classify">pygeoda (classify)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.hinge15_breaks.html">pygeoda.hinge15_breaks</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.hinge30_breaks.html">pygeoda.hinge30_breaks</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.natural_breaks.html">pygeoda.natural_breaks</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.quantile_breaks.html">pygeoda.quantile_breaks</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.percentile_breaks.html">pygeoda.percentile_breaks</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.stddev_breaks.html">pygeoda.stddev_breaks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="api.html#pygeoda-data">pygeoda (data)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.mds.html">pygeoda.mds</a></li>
<li class="toctree-l3"><a class="reference internal" href="generated/pygeoda.PCA.html">pygeoda.PCA</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pygeoda</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>_ESDA with pygeoda and geopandas</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="sources/esda_geopandas.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="esda-with-pygeoda-and-geopandas">
<span id="esda-geopandas-ref"></span><h1>_ESDA with pygeoda and geopandas<a class="headerlink" href="#esda-with-pygeoda-and-geopandas" title="Permalink to this headline">¶</a></h1>
<p>For exploratory spatial data analysis (ESDA), pygeoa provides some
utility functions to allow users to easily work with geopandas and
matplotlib to visualize the results and do exploratory spatial data
analysis.</p>
<p>In this notebook, you will learn how to do ESDA with <cite>pygeoda</cite>, <cite>geopandas</cite> and <cite>matplotlib</cite>/<cite>geoplot</cite>.</p>
<div class="section" id="geopandas">
<h2>1 GeoPandas<a class="headerlink" href="#geopandas" title="Permalink to this headline">¶</a></h2>
<p>geopandas is a python library that allow users to work with geospatial
data in Python. It is an extension of pandas python library by
supporting GeoSeries type to allow spatial operations on geometric
types besides traditional data manipulation and analysis.</p>
<p>geopandas can be installed using conda or pip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">geopandas</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note: there are many dependencies of geopandas, so please check
it’s <a class="reference external" href="http://geopandas.org/install.html">documentation</a> if
encounting any issues.</p>
</div>
<p>geopandas can read geospatial data by using it’s <cite>read_file()</cite> function, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gdf</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;/path/to/shapefile.shp&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Depending on the installation of GDAL library on your machine, the
geospatial formats supported by geopandas varies. However, geopandas
can be created using a GDAL datasource:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ogr</span><span class="o">,</span> <span class="nn">geopandas</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s1">&#39;data_path&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lyr</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gdf</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="n">lyr</span><span class="p">)</span>
</pre></div>
</div>
<p>Using this approach, geopandas could load any geospatial data that
is supported by GDAL literally.</p>
</div>
<div class="section" id="matplotlib">
<h2>2 Matplotlib<a class="headerlink" href="#matplotlib" title="Permalink to this headline">¶</a></h2>
<p>Matplotlib is a Python 2D plotting library for making plots and maps.
geopandas provides functions to directly call interfaces of Matplotlib
to visualize maps, e.g. geodataframe.plot(column=’’).</p>
<p>matplotlib and Descartes can be installed using conda or pip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">matplotlib</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note: if there is error: “ImportError: The descartes package is
required for plotting polygons in geopandas.” Install descartes
will solve this problem:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">descartes</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="geopandas-pygeoda">
<h2>3 geoPandas + pygeoda<a class="headerlink" href="#geopandas-pygeoda" title="Permalink to this headline">¶</a></h2>
<p>geopandas has been an essential python library to handle geospatial data,
apply spatial operations and visualize maps. It is becoming an entry point
of the spatial data analysis. A typical workflow of spatial data analysis
in python could be beginning with geopandas: either load a geospatial data
(e.g. ESRI shapefile) using geopandas, or create a geopandas dataframe
from raw data like spreadsheets, databases etc. The geodataframe is then
used to do spatial data analysis, store the results of data analysis, and
finally visualize the results in terms of plots and maps using matplotlib.</p>
<img alt="https://github.com/lixun910/images/blob/master/libgeoda/pygeoda_workflow.png?raw=true" src="https://github.com/lixun910/images/blob/master/libgeoda/pygeoda_workflow.png?raw=true" />
<p>In this notebook, the geospatial dataset Guerry in ESRI Shapefile format
will be used for demonstration. You can download this dataset at:
<a class="reference external" href="https://geodacenter.github.io/data-and-lab/Guerry/">https://geodacenter.github.io/data-and-lab/Guerry/</a></p>
<div class="section" id="load-geospatial-data-in-geopandas">
<h3>3.1 Load geospatial data in GeoPandas<a class="headerlink" href="#load-geospatial-data-in-geopandas" title="Permalink to this headline">¶</a></h3>
<p>To load this geospatial data in GeoPandas:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">geopandas</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gdf</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;./data/Guerry.shp&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, you will get an instance of geodataframe: <cite>gdf</cite>.
You can check the meta data and content of this geodataframe:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="go">Index([ u&#39;CODE_DE&#39;,    u&#39;COUNT&#39;,  u&#39;AVE_ID_&#39;,     u&#39;dept&#39;,   u&#39;Region&#39;,</span>
<span class="go">    u&#39;Dprtmnt&#39;,  u&#39;Crm_prs&#39;,  u&#39;Crm_prp&#39;,  u&#39;Litercy&#39;,  u&#39;Donatns&#39;,</span>
<span class="go">    u&#39;Infants&#39;,  u&#39;Suicids&#39;,  u&#39;MainCty&#39;,   u&#39;Wealth&#39;,  u&#39;Commerc&#39;,</span>
<span class="go">     u&#39;Clergy&#39;,  u&#39;Crm_prn&#39;,  u&#39;Infntcd&#39;,  u&#39;Dntn_cl&#39;,  u&#39;Lottery&#39;,</span>
<span class="go">    u&#39;Desertn&#39;,  u&#39;Instrct&#39;,  u&#39;Prsttts&#39;,  u&#39;Distanc&#39;,     u&#39;Area&#39;,</span>
<span class="go">    u&#39;Pop1831&#39;, u&#39;geometry&#39;],</span>
<span class="go">  dtype=&#39;object&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
<span class="go">{u&#39;init&#39;: u&#39;epsg:27572&#39;}</span>
</pre></div>
</div>
<p>You can simply call function plot() to render the geospatial data as
a map on a plot (matplotlib):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="./images/guerry1.png"><img alt="./images/guerry1.png" src="./images/guerry1.png" style="width: 300px; height: 300px;" /></a>
</div>
<div class="section" id="create-pygeoda-object-from-geodataframe">
<h3>3.2 Create pygeoda object from geodataframe<a class="headerlink" href="#create-pygeoda-object-from-geodataframe" title="Permalink to this headline">¶</a></h3>
<p>pygeoda provides a utility function geopandas_to_geoda to easily create
a pygeoda instance for spatial data analysis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pygeoda</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">guerry</span> <span class="o">=</span> <span class="n">pygeoda</span><span class="o">.</span><span class="n">geopandas_to_geoda</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The conversion is based on using Well-Known-Binary (WKB) format
to exchange geometric data for good performance.</p>
</div>
<p>The function geopandas_to_geoda() returns an object of geoda class,
which can be then used to access GeoDa functions to do spatial data
analysis. For example, to examine the local Moran of variable “crm_prs”
(Population per Crime against persons), we first create a Queen
contiguity weights:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">queen_w</span> <span class="o">=</span> <span class="n">pygeoda</span><span class="o">.</span><span class="n">weights</span><span class="o">.</span><span class="n">queen</span><span class="p">(</span><span class="n">guerry</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">queen_w</span><span class="p">)</span>
<span class="go">Weights Meta-data:</span>

<span class="go">is symmetric:True</span>
<span class="go">sparsity:0.0</span>
<span class="go">density:5.813148788927336</span>
<span class="go">min neighbors:2</span>
<span class="go">mean neighbors:4.9411764705882355</span>
<span class="go">median neighbors:5.0</span>
<span class="go">max neighbors:8</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h3>3.3 ESDA with pygeoda and geopandas<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p><strong>Local Moran CLuster Map</strong></p>
<p>Now, with the geoda object <cite>guerry</cite>, you can call pygeoda’s spatial
analysis functions. For example, to examine the local Moran statistics
of variable “crm_prs” (Population per Crime against persons):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crm_prp</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">Crm_prs</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crm_lisa</span> <span class="o">=</span> <span class="n">pygeoda</span><span class="o">.</span><span class="n">local_moran</span><span class="p">(</span><span class="n">queen_w</span><span class="p">,</span> <span class="n">crm_prp</span><span class="p">)</span>
</pre></div>
</div>
<p>Now, with the LISA results, we can do exploratory spatial data analysis
by generating a LISA cluster map:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">lisa_colors</span> <span class="o">=</span> <span class="n">crm_lisa</span><span class="o">.</span><span class="n">GetColors</span><span class="p">()</span>
<span class="n">lisa_labels</span> <span class="o">=</span> <span class="n">crm_lisa</span><span class="o">.</span><span class="n">GetLabels</span><span class="p">()</span>

<span class="c1"># attach LISA cluster indicators to geodataframe</span>
<span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;LISA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">crm_lisa</span><span class="o">.</span><span class="n">GetClusterIndicators</span><span class="p">()</span>

<span class="k">for</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;LISA&#39;</span><span class="p">):</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">lisa_colors</span><span class="p">[</span><span class="n">ctype</span><span class="p">]</span>
    <span class="n">lbl</span> <span class="o">=</span> <span class="n">lisa_labels</span><span class="p">[</span><span class="n">ctype</span><span class="p">]</span>
    <span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">lbl</span><span class="p">,</span>
        <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
        <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>

<span class="c1"># Place legend in the lower right hand corner of the plot</span>
<span class="n">lisa_legend</span> <span class="o">=</span> <span class="p">[</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">lisa_colors</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lisa_legend</span><span class="p">,</span> <span class="n">lisa_labels</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Local Moran Cluster Map of Crm_prp</span><span class="se">\n</span><span class="s1"> Population per Crime against persons&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./images/guerry_moran.png" src="./images/guerry_moran.png" />
<p>From the above code, you can see that we still use <cite>gpf</cite> object to do
plotting. The values of cluster indicators from pygeoda’s <cite>crm_lisa</cite> object
are used to make the LISA map.This emphasis that pygeoda is a API focused
library, which only provides the core functions of spatial data analysis
for easy integration.</p>
<p>If you check the values of the cluster indicators, you will see they are
integer numbers 0 (not significant), 1 (high-high cluster),
2 (low-low cluster), 3 (low-high cluster), 4 (high-low cluster),
5 (neighborless/island), 6 (undefined), which are excatly the same with
GeoDa software when you save LISA results to a table.</p>
<p>To create a siginificant map that is associated with the Local Moran map:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;LISA_PVAL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">crm_lisa</span><span class="o">.</span><span class="n">GetPValues</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;#eeeeee&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;LISA_PVAL&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.05</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#84f576&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;LISA_PVAL&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.01</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#53c53c&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">gdf</span><span class="p">[</span><span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;LISA_PVAL&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.001</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;#348124&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Local Moran Significance Map of Crm_prp</span><span class="se">\n</span><span class="s1"> Population per Crime against persons&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./images/guerry_moran_sig.png" src="./images/guerry_moran_sig.png" />
<p><strong>Local Geary Cluster Map</strong></p>
<p>Another example is to create a map of local Geary:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crm_geary</span> <span class="o">=</span> <span class="n">pygeoda</span><span class="o">.</span><span class="n">local_geary</span><span class="p">(</span><span class="n">queen_w</span><span class="p">,</span> <span class="n">crm_prp</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, use matplotlib to create a local geary map:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">lisa_colors</span> <span class="o">=</span> <span class="n">crm_geary</span><span class="o">.</span><span class="n">GetColors</span><span class="p">()</span>
<span class="n">lisa_labels</span> <span class="o">=</span> <span class="n">crm_geary</span><span class="o">.</span><span class="n">GetLabels</span><span class="p">()</span>

<span class="c1"># attach LISA cluster indicators to geodataframe</span>
<span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;GEARY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">crm_geary</span><span class="o">.</span><span class="n">GetClusterIndicators</span><span class="p">()</span>

<span class="k">for</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;GEARY&#39;</span><span class="p">):</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">lisa_colors</span><span class="p">[</span><span class="n">ctype</span><span class="p">]</span>
    <span class="n">lbl</span> <span class="o">=</span> <span class="n">lisa_labels</span><span class="p">[</span><span class="n">ctype</span><span class="p">]</span>
    <span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">lbl</span><span class="p">,</span>
        <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
        <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>

<span class="c1"># Place legend in the lower right hand corner of the plot</span>
<span class="n">lisa_legend</span> <span class="o">=</span> <span class="p">[</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">lisa_colors</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lisa_legend</span><span class="p">,</span> <span class="n">lisa_labels</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Local Geary Cluster Map of Crm_prp</span><span class="se">\n</span><span class="s1"> Population per Crime against persons&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./images/guerry_geary.png" src="./images/guerry_geary.png" />
<p><strong>Local G Cluster Map</strong></p>
<p>To create a map of local Getis-Order G:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">crm_g</span> <span class="o">=</span> <span class="n">pygeoda</span><span class="o">.</span><span class="n">local_g</span><span class="p">(</span><span class="n">queen_w</span><span class="p">,</span> <span class="n">crm_prp</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, use matplotlib to create a local geary map:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">lisa_colors</span> <span class="o">=</span> <span class="n">crm_g</span><span class="o">.</span><span class="n">GetColors</span><span class="p">()</span>
<span class="n">lisa_labels</span> <span class="o">=</span> <span class="n">crm_g</span><span class="o">.</span><span class="n">GetLabels</span><span class="p">()</span>

<span class="c1"># attach LISA cluster indicators to geodataframe</span>
<span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;GO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">crm_g</span><span class="o">.</span><span class="n">GetClusterIndicators</span><span class="p">()</span>

<span class="k">for</span> <span class="n">ctype</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;GO&#39;</span><span class="p">):</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">lisa_colors</span><span class="p">[</span><span class="n">ctype</span><span class="p">]</span>
    <span class="n">lbl</span> <span class="o">=</span> <span class="n">lisa_labels</span><span class="p">[</span><span class="n">ctype</span><span class="p">]</span>
    <span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">,</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">lbl</span><span class="p">,</span>
        <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span>
        <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>

<span class="c1"># Place legend in the lower right hand corner of the plot</span>
<span class="n">lisa_legend</span> <span class="o">=</span> <span class="p">[</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">lisa_colors</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lisa_legend</span><span class="p">,</span> <span class="n">lisa_labels</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Local Getis-Ord G Cluster Map of Crm_prp</span><span class="se">\n</span><span class="s1"> Population per Crime against persons&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./images/guerry_g.png" src="./images/guerry_g.png" />
<p><strong>SKATER Map</strong></p>
<p>To create a map of SKATER clustering results, we first run skater clustering
on the data of 6 selected variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">gdf</span><span class="o">.</span><span class="n">Crm_prs</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">gdf</span><span class="o">.</span><span class="n">Crm_prp</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">gdf</span><span class="o">.</span><span class="n">Litercy</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">gdf</span><span class="o">.</span><span class="n">Donatns</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">gdf</span><span class="o">.</span><span class="n">Infants</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span> <span class="n">gdf</span><span class="o">.</span><span class="n">Suicids</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">skater_clusters</span> <span class="o">=</span> <span class="n">pygeoda</span><span class="o">.</span><span class="n">skater</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">queen_w</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">skater_cluster</span><span class="p">)</span>
<span class="go">((15, 74, 16, 55, 60, 39, 68, 33, 17, 82, 81, 0, 2, 40, 20, 80), (46, 50, 34, 38, 69, 47, 58, 19, 32, 41, 53, 26), (23, 79, 3, 29, 61, 21, 44, 11, 28, 13, 30, 35, 76, 77, 43, 9, 27, 45, 31, 78, 4, 10, 66, 37, 5, 14, 7, 63, 62), (49, 52, 72, 84, 8, 57, 56, 59, 42, 1, 25, 51, 48, 54, 64, 75, 18, 83, 73, 36, 24, 71, 6, 67, 65, 70, 22, 12))</span>
</pre></div>
</div>
<p>The results of the <cite>skater()</cite> function is a 2d list that represents
groups of clusters. For plotting, we first flat this 2d list to a 1d list
that each element has a value representing which cluster this element
belongs to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">flat_cluster</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">guerry</span><span class="o">.</span><span class="n">num_obs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">cid</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">skater_clusters</span><span class="p">):</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">cluster</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>       <span class="n">flat_cluster</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">cid</span>
</pre></div>
</div>
<p>You can wrap above code piece as a function which can be reused:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">flat_2dcluster</span><span class="p">(</span><span class="n">clusters</span><span class="p">):</span>
    <span class="n">num_obs</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">clusters</span><span class="p">)</span>
    <span class="n">flat_cluster</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_obs</span>
    <span class="k">for</span> <span class="n">cid</span><span class="p">,</span> <span class="n">cluster</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clusters</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">cluster</span><span class="p">:</span>
            <span class="n">flat_cluster</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">cid</span>
    <span class="k">return</span> <span class="n">flat_cluster</span>
</pre></div>
</div>
<p>To make a plot:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;SKATER_C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flat_2dcluster</span><span class="p">(</span><span class="n">skater_clusters</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;SKATER_C&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Pastel1&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;SKATER Clustering Map&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./images/guerry_skater.png" src="./images/guerry_skater.png" />
<p><strong>Max-p Clustering Map</strong></p>
<p>To make a map of Max-p clustering results, we first run skater clustering
on the data of 6 selected variables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bound_vals</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">Pop1831</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">min_bound</span> <span class="o">=</span> <span class="mf">3236.67</span> <span class="c1"># 10% of Pop1831</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">maxp_clusters</span> <span class="o">=</span> <span class="n">pygeoda</span><span class="o">.</span><span class="n">maxp</span><span class="p">(</span><span class="n">queen_w</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">bound_vals</span><span class="p">,</span> <span class="n">min_bound</span><span class="p">,</span> <span class="s2">&quot;greedy&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">maxp_clusters</span><span class="p">)</span>
<span class="go">((13, 31, 5, 45, 11, 79, 27, 78, 23, 4, 3, 43, 35, 66, 44, 30), (34, 16, 33, 55, 46, 69, 58, 47, 50, 38), (77, 9, 7, 28, 62, 29, 37, 61, 63, 10, 76), (67, 65, 83, 64, 54, 52, 51, 22, 48, 8), (0, 68, 60, 40, 2, 39, 20, 17, 21, 14), (25, 42, 24, 73, 70, 12, 71), (75, 56, 6, 1, 59, 18, 57, 72, 49, 36, 84), (80, 41, 32, 26, 19, 53, 74, 81, 15, 82))</span>
</pre></div>
</div>
<p>To make a plot using matplotlib:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;MAXP_C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flat_2dcluster</span><span class="p">(</span><span class="n">maxp_clusters</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">gdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s2">&quot;MAXP_C&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Pastel1&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Max-p Clustering Map&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>
</pre></div>
</div>
<img alt="./images/guerry_maxp.png" src="./images/guerry_maxp.png" />
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="pygeoda API reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="spatial_clustering.html" class="btn btn-neutral float-left" title="6 Spatial Clustering" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Xun Li; Luc Anselin.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>